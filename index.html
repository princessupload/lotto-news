<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lottery Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Cormorant+Garamond:wght@300;400;600&family=Libre+Baskerville:wght@400;700&family=EB+Garamond:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cormorant Garamond', serif;
            background: linear-gradient(135deg, #F9A8D4 0%, #B0E0E6 50%, #ff75cc 100%);
            min-height: 100vh;
            padding: 20px;
            color: #000000;
            position: relative;
            overflow-x: hidden;
        }

        /* Sparkle background animation */
        body::before,
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        body::before {
            background-image:
                radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,0.9), transparent),
                radial-gradient(2px 2px at 60% 70%, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 1px at 50% 50%, rgba(255,255,255,0.7), transparent),
                radial-gradient(1px 1px at 80% 10%, rgba(255,255,255,0.7), transparent),
                radial-gradient(2px 2px at 90% 60%, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 1px at 33% 50%, rgba(255,255,255,0.6), transparent),
                radial-gradient(1px 1px at 66% 20%, rgba(255,255,255,0.6), transparent);
            background-size: 200% 200%;
            animation: sparkle 8s linear infinite;
            opacity: 0.6;
        }

        body::after {
            background-image:
                radial-gradient(3px 3px at 10% 80%, rgba(255, 215, 0, 0.5), transparent),
                radial-gradient(4px 4px at 80% 30%, rgba(255, 117, 204, 0.5), transparent),
                radial-gradient(3px 3px at 40% 10%, rgba(135, 206, 235, 0.5), transparent);
            background-size: 150% 150%;
            animation: floaty 16s ease-in-out infinite;
            opacity: 0.5;
        }

        @keyframes sparkle {
            0%, 100% {
                background-position: 0% 0%, 0% 0%, 0% 0%, 0% 0%, 0% 0%, 0% 0%, 0% 0%;
            }
            50% {
                background-position: 100% 100%, 100% 100%, 100% 100%, 100% 100%, 100% 100%, 100% 100%, 100% 100%;
            }
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border: 4px solid #ff47bb;
            border-radius: 25px;
            box-shadow: 0 8px 32px rgba(255, 71, 187, 0.4), inset 0 0 20px rgba(255, 117, 204, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        header::before,
        header::after {
            content: '';
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.35);
            filter: blur(2px);
            animation: halo 10s linear infinite;
            pointer-events: none;
        }

        header::before {
            top: -40px;
            left: -30px;
        }

        header::after {
            bottom: -50px;
            right: -20px;
            animation-delay: 3s;
        }

        .heart-icon {
            display: inline-block;
            width: 0.8em;
            height: 0.8em;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='hg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23ff75cc'/%3E%3Cstop offset='100%25' stop-color='%23ff47bb'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath d='M50 25 C50 15 70 10 80 25 C95 45 50 80 50 80 C50 80 5 45 20 25 C30 10 50 15 50 25 Z' fill='url(%23hg)' stroke='%23fff' stroke-width='3'/%3E%3Ccircle cx='35' cy='30' r='8' fill='%23fff' opacity='0.5'/%3E%3C/svg%3E") no-repeat center/contain;
            vertical-align: middle;
            animation: heartBeat 1.5s ease-in-out infinite;
            filter: drop-shadow(0 2px 4px rgba(255, 71, 187, 0.4));
        }

        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            15% { transform: scale(1.15); }
            30% { transform: scale(1); }
            45% { transform: scale(1.1); }
            60% { transform: scale(1); }
        }

        h1 {
            font-family: 'Playfair Display', serif;
            background: linear-gradient(135deg, #ff47bb 0%, #ff75cc 50%, #F9A8D4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 3.5em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 4px;
            filter: drop-shadow(2px 2px 3px rgba(255, 71, 187, 0.3));
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { filter: drop-shadow(2px 2px 3px rgba(255, 71, 187, 0.3)) brightness(1); }
            50% { filter: drop-shadow(2px 2px 8px rgba(255, 71, 187, 0.6)) brightness(1.1); }
        }

        @keyframes floaty {
            0% { transform: translate3d(-5%, -5%, 0) scale(1); opacity: 0.4; }
            50% { transform: translate3d(5%, 5%, 0) scale(1.1); opacity: 0.8; }
            100% { transform: translate3d(-5%, -5%, 0) scale(1); opacity: 0.4; }
        }

        .subtitle {
            font-family: 'EB Garamond', serif;
            font-size: 1.4em;
            color: #ff47bb;
            margin-bottom: 15px;
            font-style: italic;
        }

        .subtitle::before,
        .subtitle::after {
            content: '';
            display: inline-block;
            width: 12px;
            height: 12px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M50 15 C50 5 70 0 80 15 C95 35 50 70 50 70 C50 70 5 35 20 15 C30 0 50 5 50 15 Z' fill='%23ff75cc'/%3E%3C/svg%3E") no-repeat center/contain;
            margin: 0 8px;
            opacity: 0.7;
        }

        .clock-container {
            background: linear-gradient(135deg, #B0E0E6 0%, #7DD3FC 100%);
            border: 3px solid #7DD3FC;
            border-radius: 20px;
            padding: 12px 24px;
            display: inline-block;
            margin-bottom: 15px;
            font-family: 'Libre Baskerville', serif;
            font-size: 1.1em;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(125, 211, 252, 0.4);
            color: #000;
        }

        .header-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .btn {
            background: linear-gradient(135deg, #7DD3FC 0%, #B0E0E6 100%);
            color: #000000;
            border: 3px solid #7DD3FC;
            border-radius: 20px;
            padding: 12px 28px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Libre Baskerville', serif;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(125, 211, 252, 0.4);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(125, 211, 252, 0.6);
        }

        .btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -10%;
            width: 20%;
            height: 200%;
            background: rgba(255,255,255,0.6);
            transform: rotate(25deg);
            animation: buttonShine 3s linear infinite;
        }

        .btn.pink {
            background: linear-gradient(135deg, #ff47bb 0%, #ff75cc 100%);
            border-color: #ff47bb;
            color: #FFFFFF;
            box-shadow: 0 4px 15px rgba(255, 71, 187, 0.4);
        }

        .btn.pink:hover {
            box-shadow: 0 6px 20px rgba(255, 71, 187, 0.6);
        }

        .lottery-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
            position: relative;
        }

        .lottery-grid::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image: radial-gradient(circle, rgba(255,255,255,0.12) 0%, transparent 55%);
            background-size: 80px 80px;
            animation: gridTwinkle 12s linear infinite;
            pointer-events: none;
        }

        @media (max-width: 1400px) {
            .lottery-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            h1 { font-size: 2.5em; }
            .lottery-grid { grid-template-columns: 1fr !important; }
        }

        .lottery-card {
            background: rgba(255, 255, 255, 0.95);
            border: 4px solid;
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .lottery-card::before,
        .lottery-card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            animation: twinkle 4s ease-in-out infinite;
        }

        .lottery-card::after {
            background: radial-gradient(circle, rgba(255, 215, 0, 0.15) 0%, transparent 60%);
            animation-duration: 6s;
        }

        @keyframes twinkle {
            0%, 100% { transform: rotate(0deg); opacity: 0; }
            50% { transform: rotate(180deg); opacity: 1; }
        }

        .lottery-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        .lottery-card.l4l {
            border-color: #ff47bb;
            box-shadow: 0 8px 32px rgba(255, 71, 187, 0.3);
        }

        .lottery-card.la {
            border-color: #7DD3FC;
            box-shadow: 0 8px 32px rgba(125, 211, 252, 0.3);
        }

        .lottery-card.pb {
            border-color: #E31B23;
            box-shadow: 0 8px 32px rgba(227, 27, 35, 0.3);
        }

        .lottery-card.mm {
            border-color: #C0C0C0;
            box-shadow: 0 8px 32px rgba(192, 192, 192, 0.3);
        }

        .lottery-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 3px dashed rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }

        .lottery-icon {
            width: 50px;
            height: 50px;
            filter: drop-shadow(0 4px 8px rgba(255, 71, 187, 0.3));
        }

        .lottery-name {
            font-family: 'Playfair Display', serif;
            font-size: 1.6em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .draw-schedule {
            font-size: 0.85em;
            color: #ff47bb;
            font-weight: 600;
            margin-bottom: 8px;
            font-family: 'Libre Baskerville', serif;
        }

        .countdown {
            background: linear-gradient(135deg, #FFEB3B 0%, #FFD700 100%);
            border: 3px solid #FFD700;
            border-radius: 15px;
            padding: 12px;
            text-align: center;
            font-weight: 700;
            margin-bottom: 12px;
            font-size: 1em;
            font-family: 'Libre Baskerville', serif;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        .countdown.soon {
            background: linear-gradient(135deg, #ff47bb 0%, #ff75cc 100%);
            border-color: #ff47bb;
            color: #FFFFFF;
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 4px 15px rgba(255, 71, 187, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 6px 25px rgba(255, 71, 187, 0.6); }
        }

        .draw-date {
            font-size: 0.95em;
            font-weight: 600;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #B0E0E6 0%, #87CEEB 100%);
            padding: 10px;
            border-radius: 12px;
            text-align: center;
            font-family: 'EB Garamond', serif;
            box-shadow: 0 2px 8px rgba(135, 206, 235, 0.3);
            position: relative;
            z-index: 1;
        }

        .numbers-container {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
            position: relative;
            z-index: 1;
        }

        .number-ball {
            width: 48px;
            height: 48px;
            border: 3px solid rgba(0,0,0,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.3em;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15), inset 0 2px 4px rgba(255,255,255,0.5);
            font-family: 'Libre Baskerville', serif;
            position: relative;
        }

        .number-ball.main {
            background: linear-gradient(135deg, #7DD3FC 0%, #B0E0E6 100%);
        }

        .number-ball.bonus {
            background: linear-gradient(135deg, #ff47bb 0%, #ff75cc 100%);
            color: #FFFFFF;
            box-shadow: 0 4px 12px rgba(255, 71, 187, 0.4), inset 0 2px 4px rgba(255,255,255,0.5);
        }

        .number-ball::before {
            content: '';
            position: absolute;
            width: 60%;
            height: 60%;
            top: 5px;
            left: 8px;
            border-radius: 50%;
            background: rgba(255,255,255,0.45);
            filter: blur(1px);
        }

        .number-ball.bonus::after {
            content: 'â™¥';
            position: absolute;
            top: -15px;
            right: -12px;
            font-size: 1.2em;
            color: #FFD700;
            filter: drop-shadow(0 0 3px #FFD700);
            animation: rotate 3s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes halo {
            0% { transform: translate3d(0,0,0) scale(0.9); opacity: 0.4; }
            50% { transform: translate3d(15px, 10px, 0) scale(1.1); opacity: 0.8; }
            100% { transform: translate3d(0,0,0) scale(0.9); opacity: 0.4; }
        }

        @keyframes buttonShine {
            0% { transform: translateX(-50%) rotate(25deg); opacity: 0; }
            40% { opacity: 0.6; }
            100% { transform: translateX(350%) rotate(25deg); opacity: 0; }
        }

        @keyframes gridTwinkle {
            0% { transform: translateY(0); opacity: 0.3; }
            50% { opacity: 0.6; }
            100% { transform: translateY(-20px); opacity: 0.3; }
        }

        .jackpot-section {
            background: linear-gradient(135deg, #87CEEB 0%, #B0E0E6 100%);
            border: 3px solid #87CEEB;
            border-radius: 15px;
            padding: 18px;
            margin-bottom: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(135, 206, 235, 0.3);
            position: relative;
            z-index: 1;
        }

        .jackpot-label {
            font-size: 0.85em;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 8px;
            font-family: 'Libre Baskerville', serif;
            letter-spacing: 1px;
            color: #000;
        }

        .jackpot-amount {
            font-size: 2em;
            font-weight: 700;
            background: linear-gradient(135deg, #E31B23 0%, #ff47bb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: 'Playfair Display', serif;
            margin-bottom: 8px;
            filter: drop-shadow(1px 1px 2px rgba(227, 27, 35, 0.3));
        }

        .jackpot-details {
            font-size: 0.9em;
            color: #000;
            line-height: 1.6;
            font-family: 'EB Garamond', serif;
        }

        .jackpot-details div {
            margin: 3px 0;
        }

        .history-btn {
            width: 100%;
            background: linear-gradient(135deg, #ff75cc 0%, #F9A8D4 100%);
            color: #000000;
            border: 3px solid #ff75cc;
            border-radius: 20px;
            padding: 14px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Libre Baskerville', serif;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(255, 117, 204, 0.4);
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .history-btn:hover {
            background: linear-gradient(135deg, #ff47bb 0%, #ff75cc 100%);
            color: #FFFFFF;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 71, 187, 0.6);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            border: 5px solid #ff47bb;
            border-radius: 25px;
            box-shadow: 0 12px 40px rgba(255, 71, 187, 0.5);
            padding: 30px;
            max-width: 900px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #ff47bb;
        }

        .modal-title {
            font-size: 2em;
            font-weight: 700;
            text-transform: uppercase;
            font-family: 'Playfair Display', serif;
            background: linear-gradient(135deg, #ff47bb 0%, #ff75cc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .close-btn {
            background: linear-gradient(135deg, #E31B23 0%, #ff47bb 100%);
            color: #FFFFFF;
            border: 3px solid #E31B23;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-weight: 700;
            cursor: pointer;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(227, 27, 35, 0.4);
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            transform: rotate(90deg);
            box-shadow: 0 6px 16px rgba(227, 27, 35, 0.6);
        }

        .history-list {
            display: grid;
            gap: 10px;
        }

        .history-item {
            background: linear-gradient(135deg, #F9A8D4 0%, #ffddee 100%);
            border: 2px solid #ff75cc;
            border-radius: 12px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            box-shadow: 0 2px 8px rgba(249, 168, 212, 0.3);
        }

        .history-date {
            font-weight: 700;
            min-width: 100px;
            font-family: 'Libre Baskerville', serif;
        }

        .history-numbers {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .history-numbers .num {
            background: linear-gradient(135deg, #7DD3FC 0%, #B0E0E6 100%);
            border: 2px solid #7DD3FC;
            border-radius: 8px;
            padding: 6px 10px;
            font-weight: 700;
            min-width: 35px;
            text-align: center;
            font-family: 'Libre Baskerville', serif;
            box-shadow: 0 2px 6px rgba(125, 211, 252, 0.3);
        }

        .history-numbers .num.bonus {
            background: linear-gradient(135deg, #ff47bb 0%, #ff75cc 100%);
            border-color: #ff47bb;
            color: #FFFFFF;
            box-shadow: 0 2px 6px rgba(255, 71, 187, 0.4);
        }

        .loading {
            text-align: center;
            font-size: 2em;
            font-weight: 700;
            padding: 50px;
            background: rgba(255, 255, 255, 0.95);
            border: 4px solid #ff47bb;
            border-radius: 25px;
            box-shadow: 0 8px 32px rgba(255, 71, 187, 0.3);
            font-family: 'Playfair Display', serif;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><span class="heart-icon"></span> Lottery Tracker <span class="heart-icon"></span></h1>
            <p class="subtitle">Live Draws & Jackpots for Oklahoma</p>
            <div class="clock-container" id="oklahoma-clock">Loading...</div>
            <div class="header-controls">
                <button class="btn pink" onclick="refreshData()">Refresh Data</button>
                <button class="btn" id="lastUpdate">Initializing...</button>
            </div>
        </header>

        <div id="lottery-grid" class="lottery-grid">
            <div class="loading">Loading lottery data...</div>
        </div>
    </div>

    <div id="historyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">History</h2>
                <button class="close-btn" onclick="closeHistory()">x</button>
            </div>
            <div id="historyContent" class="history-list"></div>
        </div>
    </div>

    <script>
        const LOTTERY_INFO = {
            'L4L': { 
                name: 'Lucky for Life', 
                class: 'l4l', 
                color: '#ff47bb', 
                schedule: 'Daily', 
                drawTime: '21:38', 
                days: null,
                icon: `<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <radialGradient id="l4l-core" cx="50%" cy="50%" r="60%">
                            <stop offset="0%" stop-color="#fff7c4"/>
                            <stop offset="70%" stop-color="#ff75cc"/>
                            <stop offset="100%" stop-color="#ff47bb"/>
                        </radialGradient>
                        <linearGradient id="l4l-heart" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" stop-color="#ffb5e8"/>
                            <stop offset="100%" stop-color="#ff47bb"/>
                        </linearGradient>
                    </defs>
                    <circle cx="60" cy="60" r="46" fill="url(#l4l-core)" opacity="0.9" stroke="#fff" stroke-width="3"/>
                    <path d="M60 35 C60 25, 80 25, 80 45 C80 60, 60 75, 60 75 C60 75, 40 60, 40 45 C40 25, 60 25, 60 35 Z"
                          fill="url(#l4l-heart)" stroke="#fff" stroke-width="2"/>
                    <circle cx="60" cy="60" r="12" fill="#FFD700" opacity="0.8"/>
                    <circle cx="82" cy="30" r="6" fill="#fff" opacity="0.7"/>
                    <circle cx="40" cy="28" r="4" fill="#fff" opacity="0.5"/>
                </svg>`
            },
            'LA': { 
                name: 'Lotto America', 
                class: 'la', 
                color: '#7DD3FC', 
                schedule: 'Mon/Wed/Sat', 
                drawTime: '22:00', 
                days: [1,3,6],
                icon: `<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="la-banner" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#7DD3FC"/>
                            <stop offset="100%" stop-color="#B0E0E6"/>
                        </linearGradient>
                    </defs>
                    <path d="M20 70 Q60 20 100 70 Q82 60 60 65 Q38 60 20 70Z" fill="#FFD700" opacity="0.35"/>
                    <path d="M20 70 Q60 30 100 70 L90 80 Q60 60 30 80Z" fill="url(#la-banner)" stroke="#fff" stroke-width="3"/>
                    <circle cx="40" cy="60" r="6" fill="#fff"/>
                    <circle cx="60" cy="50" r="6" fill="#fff"/>
                    <circle cx="80" cy="60" r="6" fill="#fff"/>
                    <path d="M25 78 L40 90 L20 100Z" fill="#7DD3FC" opacity="0.8"/>
                    <path d="M95 78 L80 90 L100 100Z" fill="#7DD3FC" opacity="0.8"/>
                </svg>`
            },
            'PB': { 
                name: 'Powerball', 
                class: 'pb', 
                color: '#E31B23', 
                schedule: 'Mon/Wed/Sat', 
                drawTime: '21:59', 
                days: [1,3,6],
                icon: `<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <radialGradient id="pb-orb" cx="40%" cy="35%" r="60%">
                            <stop offset="0%" stop-color="#fff"/>
                            <stop offset="60%" stop-color="#ff6a6a"/>
                            <stop offset="100%" stop-color="#E31B23"/>
                        </radialGradient>
                    </defs>
                    <circle cx="60" cy="60" r="40" fill="url(#pb-orb)" stroke="#fff" stroke-width="3"/>
                    <path d="M30 65 Q60 20 90 65" fill="none" stroke="#fff5d6" stroke-width="6" stroke-linecap="round" opacity="0.7"/>
                    <path d="M55 35 L65 55 L85 58 L70 70 L75 90 L60 78 L45 90 L50 70 L35 58 L55 55Z"
                          fill="#FFD700" opacity="0.9" stroke="#fff" stroke-width="2"/>
                    <circle cx="90" cy="30" r="6" fill="#fff" opacity="0.6"/>
                </svg>`
            },
            'MM': { 
                name: 'Mega Millions', 
                class: 'mm', 
                color: '#C0C0C0', 
                schedule: 'Tue/Fri', 
                drawTime: '22:00', 
                days: [2,5],
                icon: `<svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="mm-diamond" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#f6f8ff"/>
                            <stop offset="50%" stop-color="#cfd8ff"/>
                            <stop offset="100%" stop-color="#a6b8ff"/>
                        </linearGradient>
                    </defs>
                    <polygon points="60,20 90,50 60,100 30,50" fill="url(#mm-diamond)" stroke="#fff" stroke-width="3"/>
                    <polygon points="60,35 80,55 60,85 40,55" fill="#d3deff" opacity="0.8"/>
                    <circle cx="45" cy="30" r="6" fill="#FFD700" opacity="0.8"/>
                    <circle cx="75" cy="28" r="5" fill="#FFD700" opacity="0.8"/>
                    <path d="M25 80 Q60 110 95 80" fill="none" stroke="#FFD700" stroke-width="4" stroke-linecap="round" opacity="0.6"/>
                </svg>`
            }
        };

        const TAX_RATES = {
            FEDERAL: 0.24,
            OKLAHOMA: 0.0475
        };

        let lotteryData = {};

        function updateOklahomaClock() {
            const now = new Date();
            const options = { 
                timeZone: 'America/Chicago',
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            const formatted = new Intl.DateTimeFormat('en-US', options).format(now);
            document.getElementById('oklahoma-clock').textContent = `Oklahoma Time: ${formatted}`;
        }

        function calculateTaxes(cashValue) {
            const afterFederal = cashValue * (1 - TAX_RATES.FEDERAL);
            const takeHome = afterFederal * (1 - TAX_RATES.OKLAHOMA);
            return {
                cash: cashValue,
                afterFederal: afterFederal,
                takeHome: takeHome
            };
        }

        function formatMoney(amount) {
            if (amount >= 1000000) {
                return '$' + (amount / 1000000).toFixed(2) + 'M';
            }
            return '$' + amount.toLocaleString();
        }

        async function loadData() {
            try {
                const response = await fetch('/api/latest');
                if (!response.ok) throw new Error('Failed to fetch');
                
                const data = await response.json();
                lotteryData = data;
                displayData(data);
                
                const updateTime = new Date().toLocaleTimeString('en-US', { 
                    hour: 'numeric', 
                    minute: '2-digit',
                    timeZone: 'America/Chicago'
                });
                document.getElementById('lastUpdate').textContent = `Updated ${updateTime}`;
            } catch (error) {
                document.getElementById('lottery-grid').innerHTML = 
                    '<div class="loading">Failed to load data. Please refresh.</div>';
            }
        }

        function displayData(data) {
            const grid = document.getElementById('lottery-grid');
            grid.innerHTML = '';

            for (const [key, lottery] of Object.entries(data)) {
                if (key === 'timestamp') continue;

                const info = LOTTERY_INFO[key];
                if (!info) continue;

                const card = createLotteryCard(key, lottery, info);
                grid.appendChild(card);
            }

            setInterval(updateCountdowns, 1000);
        }

        function createLotteryCard(key, lottery, info) {
            const card = document.createElement('div');
            card.className = `lottery-card ${info.class}`;

            const latest = lottery.latest || {};
            const jackpot = lottery.jackpot || {};
            
            const dateStr = latest.date ? new Date(latest.date + 'T00:00:00').toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            }) : 'No data';

            const numbersHTML = latest.main ? 
                latest.main.map(n => `<div class="number-ball main">${n}</div>`).join('') +
                `<div class="number-ball bonus">${latest.bonus}</div>` :
                '<p style="text-align:center;">No recent draws</p>';

            let jackpotHTML = '';
            if (key === 'L4L') {
                const taxes = calculateTaxes(jackpot.cashValue || 5750000);
                jackpotHTML = `
                    <div class="jackpot-label">Prize</div>
                    <div class="jackpot-amount">$7K/Week for Life</div>
                    <div class="jackpot-details">
                        <div><strong>Cash Option:</strong> ${formatMoney(taxes.cash)}</div>
                        <div><strong>After Taxes:</strong> ${formatMoney(taxes.takeHome)}</div>
                    </div>
                `;
            } else {
                const cashValue = jackpot.cashValue || 0;
                if (cashValue > 0) {
                    const taxes = calculateTaxes(cashValue);
                    jackpotHTML = `
                        <div class="jackpot-label">Current Jackpot</div>
                        <div class="jackpot-amount">${jackpot.amount || 'N/A'}</div>
                        <div class="jackpot-details">
                            <div><strong>Cash Option:</strong> ${formatMoney(taxes.cash)}</div>
                            <div><strong>After Taxes:</strong> ${formatMoney(taxes.takeHome)}</div>
                        </div>
                    `;
                } else {
                    jackpotHTML = `
                        <div class="jackpot-label">Current Jackpot</div>
                        <div class="jackpot-amount">${jackpot.amount || 'N/A'}</div>
                    `;
                }
            }

            const scheduleText = jackpot.schedule || info.schedule;
            
            card.innerHTML = `
                <div class="lottery-header">
                    <div class="lottery-icon">${info.icon}</div>
                    <span class="lottery-name">${info.name}</span>
                </div>
                <div class="draw-schedule">${scheduleText}</div>
                <div class="countdown" id="countdown-${key}">
                    Loading countdown...
                </div>
                <div class="draw-date">Latest: ${dateStr}</div>
                <div class="numbers-container">
                    ${numbersHTML}
                </div>
                <div class="jackpot-section">
                    ${jackpotHTML}
                </div>
                <button class="history-btn" onclick="showHistory('${key}')">
                    View Full History
                </button>
            `;

            return card;
        }

        function updateCountdowns() {
            const now = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Chicago' }));
            
            for (const [key, info] of Object.entries(LOTTERY_INFO)) {
                const countdownEl = document.getElementById(`countdown-${key}`);
                if (!countdownEl) continue;

                const nextDraw = getNextDrawTime(key, info);
                const diff = nextDraw - now;

                if (diff <= 0) {
                    countdownEl.textContent = 'Draw Happening Now!';
                    countdownEl.classList.add('soon');
                } else {
                    const hours = Math.floor(diff / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                    
                    countdownEl.textContent = `${hours}h ${minutes}m ${seconds}s until draw`;
                    
                    if (hours < 1) {
                        countdownEl.classList.add('soon');
                    } else {
                        countdownEl.classList.remove('soon');
                    }
                }
            }
        }

        function getNextDrawTime(key, info) {
            const now = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Chicago' }));
            const [hour, minute] = info.drawTime.split(':');
            let next = new Date(now.getFullYear(), now.getMonth(), now.getDate(), parseInt(hour), parseInt(minute), 0);

            if (next <= now) {
                next.setDate(next.getDate() + 1);
            }

            if (info.days) {
                while (!info.days.includes(next.getDay())) {
                    next.setDate(next.getDate() + 1);
                }
            }

            return next;
        }

        async function showHistory(key) {
            const modal = document.getElementById('historyModal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('historyContent');
            
            const info = LOTTERY_INFO[key];
            title.textContent = `${info.name} - Full History`;
            
            content.innerHTML = '<div class="loading">Loading history...</div>';
            modal.classList.add('active');

            try {
                const response = await fetch(`/api/history/${key.toLowerCase()}`);
                if (!response.ok) throw new Error('Failed to fetch history');
                
                const data = await response.json();
                const draws = data.draws || [];
                
                content.innerHTML = draws.map(draw => `
                    <div class="history-item">
                        <span class="history-date">${draw.date || 'Unknown'}</span>
                        <div class="history-numbers">
                            ${draw.main.map(n => `<span class="num">${n}</span>`).join('')}
                            <span class="num bonus">${draw.bonus}</span>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                content.innerHTML = '<div class="loading">Failed to load history</div>';
            }
        }

        function closeHistory() {
            document.getElementById('historyModal').classList.remove('active');
        }

        async function refreshData() {
            const btn = event.target;
            btn.textContent = 'Refreshing...';
            btn.disabled = true;

            try {
                await fetch('/api/refresh', { method: 'POST' });
                await loadData();
            } catch (error) {
                // Silent error handling
            } finally {
                btn.textContent = 'Refresh Data';
                btn.disabled = false;
            }
        }

        document.getElementById('historyModal').addEventListener('click', function(e) {
            if (e.target === this) closeHistory();
        });

        updateOklahomaClock();
        setInterval(updateOklahomaClock, 1000);
        
        loadData();
        setInterval(loadData, 5 * 60 * 1000);
    </script>
</body>
</html>
